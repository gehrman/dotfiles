# .zshrc is sourced in interactive shells.
# It should contain commands to set up aliases,
# functions, options, key bindings, etc.

#clear
#unsetopt zle
#PS1='$ '
#return

## Command Completion Settings
if [[ $TERM == "dumb" ]]; then
    PS1="zsh$ "
    return
fi

# register the completions folder
fpath=(~/.zsh/completions $fpath)

autoload -U compinit
compinit
setopt complete_aliases

# Show the completion menu when >= 2 items.
zstyle ":completion:*" menu select=2

# Allow tab completion in the middle of a word.
setopt COMPLETE_IN_WORD

## keep background processes at full speed
#setopt NOBGNICE
## restart running processes on exit
#setopt HUP

## history
setopt APPEND_HISTORY
## for sharing history between zsh processes
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
# save 2048 lines of history in the right location
export HISTSIZE=2048
export SAVEHIST=$HISTSIZE
export HISTFILE="~/.zsh_history"
export EDITOR=vim

# Necessary for emacs themes to not be terrible. Note we want to preserve
# "dumb" terminals so as to not screw with emacs tramp mode.
if [[ $TERM != "dumb" ]]; then
    export TERM=xterm-256color
fi

## never ever beep ever
#setopt NO_BEEP

## automatically decide when to page a list of completions
#LISTMAX=0

## disable mail checking
#MAILCHECK=0

# autoload -U colors
#colors

export PATH=/usr/local/bin:~/.bin:~/.local/bin:$PATH

# Use a snake prompt. Hiss.
export PYTHONSTARTUP=~/.pythonrc

grepitall() {
    if [ "$2" != "" ]; then
        grep -irn $*;
    else
        grep -irn $1 .;
    fi
}

grepitsome() {
    if [ "$2" != "" ]; then
        grep -rn $*;
    else
        grep -rn $1 .;
    fi
}


add-ssh-identities() {
    for key in `ls ~/.ssh/id*[^.pub,.ppk]`; do
        ssh-add $key
    done
}
alias asi="add-ssh-identities"
alias asl="ssh-add -l"


# Stop backwards-kill correctly:
#export WORDCHARS=`echo $WORDCHARS | sed -e 's/\///;s/\.//'`
export WORDCHARS=`echo $WORDCHARS | sed -e 's/\///'`

alias antigrep="grep -v"
alias e="emacsclient -t"

# Tmuxxing
alias tms="tmux source"
alias tmls="tmux list-sessions"
alias tma="tmux attach -d"
alias tmat="tmux attach -d -t"

# Virtualenv commands.
alias createvirtualenv='. ~/.bin/create_virtualenv.sh'
alias recreatevirtualenv='. ~/.bin/recreate_virtualenv.sh'
alias refreshvirtualenv='. ~/.bin/refresh_virtualenv.sh'
alias startvirtualenv='. ~/.bin/start_virtualenv.sh'
alias stopvirtualenv='deactivate' # Included for completeness... it's a silly thing to do.
alias destroyvirtualenv='. ~/.bin/destroy_virtualenv.sh'
alias listvirtualenvs='. ~/.bin/list_virtualenvs.sh'
alias annotatevirtualenv='. ~/.bin/annotate_virtualenv.sh'
alias listinstalledeggs='. ~/.bin/list_installed_eggs.sh'

compdef _activate_virtualenv refreshvirtualenv

# Tab-completions are nice.
compdef _activate_virtualenv recreatevirtualenv
compdef _activate_virtualenv startvirtualenv
compdef _activate_virtualenv destroyvirtualenv
compdef _activate_virtualenv annotatevirtualenv
compdef _activate_virtualenv listinstalledeggs

# Build script
alias build_egg='. ~/.bin/build_egg.sh'

# Current-shell command aliases.
alias rezsh='source ~/.zshrc'
alias ghn="cd /wayfair/home/gehrman"
alias gcn="cd /wayfair/home/gehrman/dev"
alias bline='beeline -u jdbc:hive2://bobigdatahive01.csnzoo.com:10000 -n gehrman'

if [[ $TERM != "dumb" ]]; then
    source ~/.zsh/conf/prompt
    source ~/.zsh/conf/keybinds
    source ~/.zsh/conf/functions
fi
if [[ `uname` == "Darwin" ]]; then
    source ~/.zsh/conf/osx
elif [[ `uname` == "Linux" ]]; then
    source ~/.zsh/conf/linux
fi

if [[ -e ~/.zsh/conf/settings.private ]]; then
    source ~/.zsh/conf/settings.private
fi

#Use vim bindings.
bindkey -v

# Vim history bindings.
bindkey '^P' up-history
bindkey '^N' down-history

# History search was clobbered when we set vim mode.
bindkey '^r' history-incremental-search-backward

function zle-line-init zle-keymap-select {
    VIM_PROMPT="%{$fg_bold[yellow]%} [% cmd]% %{$reset_color%}"
    RPROMPT="${${KEYMAP/vicmd/$VIM_PROMPT}/(main|viins)/}"
    zle reset-prompt
}
zle -N zle-line-init
zle -N zle-keymap-select

# time in tenths of a second after key-press to toggle mode switch
# this *does* have other effects!!
export KEYTIMEOUT=2

stty ixany
stty ixoff -ixon
stty stop undef
stty start undef
